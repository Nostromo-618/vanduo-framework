#!/bin/sh

# Skip build for docs-only commits
staged_files=$(git diff --cached --name-only)

if [ -z "$staged_files" ]; then
	exit 0
fi

docs_only=true
for file in $staged_files; do
	case "$file" in
		*.md) ;;
		*) docs_only=false; break ;;
	esac
done

if [ "$docs_only" = true ]; then
	if echo "$staged_files" | grep -q '^dist/'; then
		echo "Docs-only commit detected, but dist/ is staged."
		echo "Unstage dist/ (git restore --staged dist) or include non-doc changes."
		exit 1
	fi
	echo "Docs-only commit detected. Skipping build."
	exit 0
fi

# Run build to ensure dist/ is up to date with latest changes
echo "Running Vanduo build before commit..."
pnpm run build

# Stage the updated dist files
git add dist/

echo "Build complete and dist/ staged, proceeding with commit..."
